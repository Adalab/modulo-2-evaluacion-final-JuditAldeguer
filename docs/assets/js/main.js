"use strict";const input=document.querySelector(".js_input"),searchBtn=document.querySelector(".js_search_btn"),favoritesResults=document.querySelector(".js_results_favorites"),resetBtn=document.querySelector(".js_reset_btn"),resultsSection=document.querySelector(".js_results");let classFav,serieImage,favoriteImage,favorites=[],series=[];function getFromAPI(){let e;e=""===input.value?"//api.tvmaze.com/shows?page=1":"//api.tvmaze.com/search/shows?q="+input.value,fetch(e).then(e=>{if(e.ok)return e.json();throw e}).then(e=>arrayConverter(e)).then(()=>paintSeries()).catch(e=>console.error(e))}function arrayConverter(e){let t;if(e.length>10){const a=e.slice(0,11);series=a.map(e=>(t={name:e.name,id:e.id,image:e.image},t))}else series=e.map(e=>(t={name:e.show.name,id:e.show.id,image:e.show.image},t));setInLocalStorage(),console.log(series)}function setInLocalStorage(){if(""!==input.value){const e=JSON.stringify(series);localStorage.setItem("series"+input.value,e)}if(favorites!==[]){const e=JSON.stringify(favorites);localStorage.setItem("fav",e)}}function controlLocalStorage(){const e=localStorage.getItem("series"+input.value),t=JSON.parse(e);null!==t?(series=t,console.log("SERIES already in LocalStorage")):(console.log("SERIES NOT in LocalStorage"),getFromAPI()),paintSeries();const a=localStorage.getItem("favorites");{const e=JSON.parse(a);favorites=e,console.log("FAVORITES already in LocalStorage"),console.log(favorites),paintFavorites()}}function handleFavorite(e){const t=parseInt(e.currentTarget.id),a=e.currentTarget,s=document.querySelectorAll(".series--container");for(const e of series)if(e.id===t){classFav="series--favorite",arrayFavUpdate(t);for(const e of s)e.innerHTML===a.innerHTML&&e.classList.toggle(classFav)}else classFav="";paintFavorites()}function arrayFavUpdate(e){const t=series.find(t=>t.id===e),a=favorites.findIndex(t=>t.id===e);-1===a?favorites.push(t):favorites.splice(a,1)}function paintFavorites(){console.log(favorites);let e="";if(favorites!==[]){for(const t of favorites)getImageUrlFav(t),e+=`\n      <li class="favorites--container series--favorite" id="${t.id}">\n          <img src="${favoriteImage}" alt="${t.name}" class="favorites--img"></img>\n          <h2>${t.name}</h2>\n          <button class="favorites--Xbutton js__Xbutton">X</button>\n      </li>`;xBtnfavListener()}favoritesResults.innerHTML=e,setInLocalStorage()}function isFavorite(e){for(const t of favorites)classFav=t===e?"series--favorite":"";classFav=""}function getImageUrlFav(e){favoriteImage=null===e.image?"https://via.placeholder.com/210x295/7C7E29/ffff/?text="+e.name:e.image.medium}function handleResetFavorites(e){e.preventDefault(),favorites=[],localStorage.removeItem(favorites),paintFavorites()}function handleXButtonFavorites(e){e.preventDefault();const t=e.currentTarget;favorites.remove(t),paintFavorites()}function getImageUrl(e){serieImage=null===e.image?"https://via.placeholder.com/210x295/7C7E29/ffff/?text="+e.name:e.image.medium}function paintSeries(){let e="<h3>Search result</h3>";for(const t of series)getImageUrl(t),isFavorite(t),e+=`\n        <div class="series--container ${classFav}" id="${t.id}">\n            <img src="${serieImage}" alt="${t.name}" class="img"></img>\n            <h2>${t.name}</h2>\n        </div>`;resultsSection.innerHTML=e,favListener()}function handleGetSeries(e){e.preventDefault(),controlLocalStorage()}function favListener(){const e=document.querySelectorAll(".series--container");for(const t of e)t.addEventListener("click",handleFavorite)}function xBtnfavListener(){const e=document.querySelectorAll(".js__Xbutton");for(const t of e)t.addEventListener("click",handleXButtonFavorites)}paintFavorites(),document.addEventListener("load",handleGetSeries),document.addEventListener("load",favListener),searchBtn.addEventListener("click",handleGetSeries),document.querySelector(".js_form").addEventListener("submit",e=>e.preventDefault()),resetBtn.addEventListener("click",handleResetFavorites);